#!/bin/bash
set -e

CGROUP_NAME="mygroup"
CGROUP_PATH="/sys/fs/cgroup/$CGROUP_NAME"

# Enable controllers including cpuset
echo "+cpu +memory +cpuset" | sudo tee /sys/fs/cgroup/cgroup.subtree_control >/dev/null

# Create cgroup
sudo mkdir -p "$CGROUP_PATH"

# Set cpuset constraints (REQUIRED before adding processes)
echo 0 | sudo tee "$CGROUP_PATH/cpuset.cpus" >/dev/null
echo 0 | sudo tee "$CGROUP_PATH/cpuset.mems" >/dev/null

# Set memory and CPU limits
echo $((10 * 1024 * 1024)) | sudo tee "$CGROUP_PATH/memory.max" >/dev/null
echo "20000 100000" | sudo tee "$CGROUP_PATH/cpu.max" >/dev/null

